# Grav Static File Cache Plugin

[Fabrizio Branca](http;//fbrnc.net)

This plugin implements a full page cache for [Grav](http://getgrav.org/). The caching is very simple and assumes that the content generated by Grav is purely static.
No hole-punching, no special handling for parameters and it will only process GET requests.

## How it works

Using the last event that gets fired during the request lifecycle (`onOutputRendered`) this plugin will write the output to a static file on the disk.

This first event (`onPluginsInitialized`) will check if there's a cached file for the current request and deliver it instead. 

This is the no-configuration approach. 

But actually this plugin is designed to have the content delivered directly through mod_rewrite, so that there's absolutely no PHP overhead. 
To make this happen add following lines to your .htaccess file. 

```
## Static file cache:
RewriteCond %{DOCUMENT_ROOT}/cache/staticfilecache/%{HTTP_HOST}/%{REQUEST_URI}/index.html -f
RewriteCond %{REQUEST_METHOD} GET
RewriteCond %{HTTP:Pragma} !no-cache
RewriteCond %{HTTP:Cache-Control} !no-cache
RewriteRule .* /cache/staticfilecache/%{HTTP_HOST}/%{REQUEST_URI}/index.html [L]
RewriteRule ^(cache/staticfilecache/.*) $1 [L]
```

Note: the mod_rewrite configuration will never fire for the root page. This is when the PHP implementation in the `onPluginsInitialized` event comes into play and 
delivers the page instead.

## Debugging

This plugin adds an HTML comment to the end of the page that indicates when the page has been generated in the first place. 
If the content es delivered via PHP instead of mod_rewrite you'll find an extra comment saying 'via event'.

## Purging the cache

The cache will **not** be purged automatically! You have to manually delete to content of `cache/staticfilecache`! 

## Disabling the module

You can disable the module via configuration, but please be aware that this will not delete the cached content and that your mod_rewrite configuration will continue to server cached content! 
```
enabled: false
```

## Refreshing indiviual pages

Following lines will result in bypassing the delivery of the cached content. The request will hit Grav which will write a new copy of the content to the filesystem at the end of the request. 
